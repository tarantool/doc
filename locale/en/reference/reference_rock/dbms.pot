
msgid "SQL DBMS Modules"
msgstr ""

msgid ""
"The discussion here in the reference is about incorporating and using two "
"modules that have already been created: the \"SQL DBMS rocks\" for MySQL and"
" PostgreSQL."
msgstr ""

msgid ""
"To call another DBMS from Tarantool, the essential requirements are: another"
" DBMS, and Tarantool. The module which connects Tarantool to another DBMS "
"may be called a \"connector\". Within the module there is a shared library "
"which may be called a \"driver\"."
msgstr ""

msgid ""
"Tarantool supplies DBMS connector modules with the module manager for Lua, "
"LuaRocks. So the connector modules may be called \"rocks\"."
msgstr ""

msgid ""
"The Tarantool rocks allow for connecting to SQL servers and executing SQL "
"statements the same way that a MySQL or PostgreSQL client does. The SQL "
"statements are visible as Lua methods. Thus Tarantool can serve as a \"MySQL"
" Lua Connector\" or \"PostgreSQL Lua Connector\", which would be useful even"
" if that was all Tarantool could do. But of course Tarantool is also a DBMS,"
" so the module also is useful for any operations, such as database copying "
"and accelerating, which work best when the application can work on both SQL "
"and Tarantool inside the same Lua routine. The methods for "
"connect/select/insert/etc. are similar to the ones in the :ref:`net.box "
"<net_box-module>` module."
msgstr ""

msgid ""
"From a user's point of view the MySQL and PostgreSQL rocks are very similar,"
" so the following sections -- \"MySQL Example\" and \"PostgreSQL Example\" "
"-- contain some redundancy."
msgstr ""

msgid "MySQL Example"
msgstr ""

msgid ""
"This example assumes that MySQL 5.5 or MySQL 5.6 or MySQL 5.7 has been "
"installed. Recent MariaDB versions will also work, the MariaDB C connector "
"is used. The package that matters most is the MySQL client developer "
"package, typically named something like libmysqlclient-dev. The file that "
"matters most from this package is libmysqlclient.so or a similar name. One "
"can use ``find`` or ``whereis`` to see what directories these files are "
"installed in."
msgstr ""

msgid ""
"It will be necessary to install Tarantool's MySQL driver shared library, "
"load it, and use it to connect to a MySQL server instance. After that, one "
"can pass any MySQL statement to the server instance and receive results, "
"including multiple result sets."
msgstr ""

msgid "Installation"
msgstr ""

msgid ""
"Check the instructions for `downloading and installing a binary package "
"<http://tarantool.org/download.html>`_ that apply for the environment where "
"Tarantool was installed. In addition to installing ``tarantool``, install "
"``tarantool-dev``. For example, on Ubuntu, add the line:"
msgstr ""

msgid "$ sudo apt-get install tarantool-dev"
msgstr ""

msgid ""
"Now, for the MySQL driver shared library, there are two ways to install:"
msgstr ""

msgid "With LuaRocks"
msgstr ""

msgid ""
"Begin by installing luarocks and making sure that tarantool is among the "
"upstream servers, as in the instructions on `rocks.tarantool.org`_, the "
"Tarantool luarocks page. Now execute this:"
msgstr ""

msgid ""
"luarocks install mysql [MYSQL_LIBDIR = *path*]\n"
"                       [MYSQL_INCDIR = *path*]\n"
"                       [--local]"
msgstr ""

msgid "For example:"
msgstr ""

msgid "$ luarocks install mysql MYSQL_LIBDIR=/usr/local/mysql/lib"
msgstr ""

msgid "With GitHub"
msgstr ""

msgid ""
"Go the site `github.com/tarantool/mysql`_. Follow the instructions there, "
"saying:"
msgstr ""

msgid ""
"$ git clone https://github.com/tarantool/mysql.git\n"
"$ cd mysql && cmake . -DCMAKE_BUILD_TYPE=RelWithDebInfo\n"
"$ make\n"
"$ make install"
msgstr ""

msgid ""
"At this point it is a good idea to check that the installation produced a "
"file named ``driver.so``, and to check that this file is on a directory that"
" is searched by the ``require`` request."
msgstr ""

msgid "Connecting"
msgstr ""

msgid ""
"Begin by making a ``require`` request for the mysql driver. We will assume "
"that the name is ``mysql`` in further examples."
msgstr ""

msgid "mysql = require('mysql')"
msgstr ""

msgid "Now, say:"
msgstr ""

msgid "*connection_name* = mysql.connect(*connection options*)"
msgstr ""

msgid "The connection-options parameter is a table. Possible options are:"
msgstr ""

msgid ":samp:`host = {host-name}` - string, default value = 'localhost'"
msgstr ""

msgid ":samp:`port = {port-number}` - number, default value = 3306"
msgstr ""

msgid ""
":samp:`user = {user-name}` - string, default value is operating-system user "
"name"
msgstr ""

msgid ":samp:`password = {password}` - string, default value is blank"
msgstr ""

msgid ":samp:`db = {database-name}` - string, default value is blank"
msgstr ""

msgid ":samp:`raise = {true|false}` - boolean, default value is false"
msgstr ""

msgid ""
"The option names, except for `raise`, are similar to the names that MySQL's "
"mysql client uses, for details see the MySQL manual at "
"`dev.mysql.com/doc/refman/5.6/en/connecting.html`_. The `raise` option "
"should be set to :codenormal:`true` if errors should be raised when "
"encountered. To connect with a Unix socket rather than with TCP, specify "
"``host = 'unix/'`` and :samp:`port = {socket-name}`."
msgstr ""

msgid "Example, using a table literal enclosed in {braces}:"
msgstr ""

msgid ""
"conn = mysql.connect({\n"
"    host = '127.0.0.1',\n"
"    port = 3306,\n"
"    user = 'p',\n"
"    password = 'p',\n"
"    db = 'test',\n"
"    raise = true\n"
"})\n"
"-- OR\n"
"conn = mysql.connect({\n"
"    host = 'unix/',\n"
"    port = '/var/run/mysqld/mysqld.sock'\n"
"})"
msgstr ""

msgid ""
"Example, creating a function which sets each option in a separate line:"
msgstr ""

msgid ""
"tarantool> -- Connection function. Usage: conn = mysql_connect()\n"
"tarantool> function mysql_connection()\n"
"         >   local p = {}\n"
"         >   p.host = 'widgets.com'\n"
"         >   p.db = 'test'\n"
"         >   conn = mysql.connect(p)\n"
"         >   return conn\n"
"         > end\n"
"---\n"
"...\n"
"tarantool> conn = mysql_connect()\n"
"---\n"
"..."
msgstr ""

msgid "We will assume that the name is 'conn' in further examples."
msgstr ""

msgid "How to ping"
msgstr ""

msgid "To ensure that a connection is working, the request is:"
msgstr ""

msgid "*connection-name*:ping()"
msgstr ""

msgid "**Example:**"
msgstr ""

msgid ""
"tarantool> conn:ping()\n"
"---\n"
"- true\n"
"..."
msgstr ""

msgid "Executing a statement"
msgstr ""

msgid "For all MySQL statements, the request is:"
msgstr ""

msgid "*connection-name*:execute(*sql-statement* [, *parameters*])"
msgstr ""

msgid ""
"where ``sql-statement`` is a string, and the optional ``parameters`` are "
"extra values that can be plugged in to replace any question marks (\"?\"s) "
"in the SQL statement."
msgstr ""

msgid ""
"tarantool> conn:execute('select table_name from information_schema.tables')\n"
"---\n"
"- - table_name: ALL_PLUGINS\n"
"  - table_name: APPLICABLE_ROLES\n"
"  - table_name: CHARACTER_SETS\n"
"  <...>\n"
"- 78\n"
"..."
msgstr ""

msgid "Closing connection"
msgstr ""

msgid "To end a session that began with ``mysql.connect``, the request is:"
msgstr ""

msgid "*connection-name*:close()"
msgstr ""

msgid ""
"tarantool> conn:close()\n"
"---\n"
"..."
msgstr ""

msgid ""
"For further information, including examples of rarely-used requests, see the"
" README.md file at `github.com/tarantool/mysql`_."
msgstr ""

msgid "Example"
msgstr ""

msgid ""
"The example was run on an Ubuntu 12.04 (\"precise\") machine where tarantool"
" had been installed in a /usr subdirectory, and a copy of MySQL had been "
"installed on ~/mysql-5.5. The mysqld server instance is already running on "
"the local host 127.0.0.1."
msgstr ""

msgid ""
"$ export TMDIR=~/mysql-5.5\n"
"$ # Check that the include subdirectory exists by looking\n"
"$ # for .../include/mysql.h. (If this fails, there's a chance\n"
"$ # that it's in .../include/mysql/mysql.h instead.)\n"
"$ [ -f $TMDIR/include/mysql.h ] && echo \"OK\" || echo \"Error\"\n"
"OK\n"
"\n"
"$ # Check that the library subdirectory exists and has the\n"
"$ # necessary .so file.\n"
"$ [ -f $TMDIR/lib/libmysqlclient.so ] && echo \"OK\" || echo \"Error\"\n"
"OK\n"
"\n"
"$ # Check that the mysql client can connect using some factory\n"
"$ # defaults: port = 3306, user = 'root', user password = '',\n"
"$ # database = 'test'. These can be changed, provided one uses\n"
"$ # the changed values in all places.\n"
"$ $TMDIR/bin/mysql --port=3306 -h 127.0.0.1 --user=root \\\n"
"    --password= --database=test\n"
"Welcome to the MySQL monitor.  Commands end with ; or \\g.\n"
"Your MySQL connection id is 25\n"
"Server version: 5.5.35 MySQL Community Server (GPL)\n"
"...\n"
"Type 'help;' or '\\h' for help. Type '\\c' to clear ...\n"
"\n"
"$ # Insert a row in database test, and quit.\n"
"mysql> CREATE TABLE IF NOT EXISTS test (s1 INT, s2 VARCHAR(50));\n"
"Query OK, 0 rows affected (0.13 sec)\n"
"mysql> INSERT INTO test.test VALUES (1,'MySQL row');\n"
"Query OK, 1 row affected (0.02 sec)\n"
"mysql> QUIT\n"
"Bye\n"
"\n"
"$ # Install luarocks\n"
"$ sudo apt-get -y install luarocks | grep -E \"Setting up|already\"\n"
"Setting up luarocks (2.0.8-2) ...\n"
"\n"
"$ # Set up the Tarantool rock list in ~/.luarocks,\n"
"$ # following instructions at rocks.tarantool.org\n"
"$ mkdir ~/.luarocks\n"
"$ echo \"rocks_servers = {[[http://rocks.tarantool.org/]]}\" >> \\\n"
"    ~/.luarocks/config.lua\n"
"\n"
"$ # Ensure that the next \"install\" will get files from Tarantool\n"
"$ # master repository. The resultant display is normal for Ubuntu\n"
"$ # 12.04 precise\n"
"$ cat /etc/apt/sources.list.d/tarantool.list\n"
"deb http://tarantool.org/dist/1.7/ubuntu/ precise main\n"
"deb-src http://tarantool.org/dist/1.7/ubuntu/ precise main\n"
"\n"
"$ # Install tarantool-dev. The displayed line should show version = 1.6\n"
"$ sudo apt-get -y install tarantool-dev | grep -E \"Setting up|already\"\n"
"Setting up tarantool-dev (1.6.6.222.g48b98bb~precise-1) ...\n"
"$\n"
"\n"
"$ # Use luarocks to install locally, that is, relative to $HOME\n"
"$ luarocks install mysql MYSQL_LIBDIR=/usr/local/mysql/lib --local\n"
"Installing http://rocks.tarantool.org/mysql-scm-1.rockspec...\n"
"... (more info about building the Tarantool/MySQL driver appears here)\n"
"mysql scm-1 is now built and installed in ~/.luarocks/\n"
"\n"
"$ # Ensure driver.so now has been created in a place\n"
"$ # tarantool will look at\n"
"$ find ~/.luarocks -name \"driver.so\"\n"
"~/.luarocks/lib/lua/5.1/mysql/driver.so\n"
"\n"
"$ # Change directory to a directory which can be used for\n"
"$ # temporary tests. For this example we assume that the name\n"
"$ # of this directory is /home/pgulutzan/tarantool_sandbox.\n"
"$ # (Change \"/home/pgulutzan\" to whatever is the user's actual\n"
"$ # home directory for the machine that's used for this test.)\n"
"$ cd /home/pgulutzan/tarantool_sandbox\n"
"\n"
"$ # Start the Tarantool server instance. Do not use a Lua initialization file.\n"
"\n"
"$ tarantool\n"
"tarantool: version 1.7.0-222-g48b98bb\n"
"type 'help' for interactive help\n"
"tarantool>"
msgstr ""

msgid ""
"Configure tarantool and load mysql module. Make sure that tarantool doesn't "
"reply \"error\" for the call to \"require()\"."
msgstr ""

msgid ""
"tarantool> box.cfg{}\n"
"...\n"
"tarantool> mysql = require('mysql')\n"
"---\n"
"..."
msgstr ""

msgid ""
"Create a Lua function that will connect to the MySQL server instance, (using"
" some factory default values for the port and user and password), retrieve "
"one row, and display the row. For explanations of the statement types used "
"here, read the Lua tutorial earlier in the Tarantool user manual."
msgstr ""

msgid ""
"tarantool> function mysql_select ()\n"
"         >   local conn = mysql.connect({\n"
"         >     host = '127.0.0.1',\n"
"         >     port = 3306,\n"
"         >     user = 'root',\n"
"         >     db = 'test'\n"
"         >   })\n"
"         >   local test = conn:execute('SELECT * FROM test WHERE s1 = 1')\n"
"         >   local row = ''\n"
"         >   for i, card in pairs(test) do\n"
"         >       row = row .. card.s2 .. ' '\n"
"         >       end\n"
"         >   conn:close()\n"
"         >   return row\n"
"         > end\n"
"---\n"
"...\n"
"tarantool> mysql_select()\n"
"---\n"
"- 'MySQL row '\n"
"..."
msgstr ""

msgid ""
"Observe the result. It contains \"MySQL row\". So this is the row that was "
"inserted into the MySQL database. And now it's been selected with the "
"Tarantool client."
msgstr ""

msgid "PostgreSQL Example"
msgstr ""

msgid ""
"This example assumes that PostgreSQL 8 or PostgreSQL 9 has been installed. "
"More recent versions should also work. The package that matters most is the "
"PostgreSQL developer package, typically named something like libpq-dev. On "
"Ubuntu this can be installed with:"
msgstr ""

msgid "$ sudo apt-get install libpq-dev"
msgstr ""

msgid ""
"However, because not all platforms are alike, for this example the "
"assumption is that the user must check that the appropriate PostgreSQL files"
" are present and must explicitly state where they are when building the "
"Tarantool/PostgreSQL driver. One can use ``find`` or ``whereis`` to see what"
" directories PostgreSQL files are installed in."
msgstr ""

msgid ""
"It will be necessary to install Tarantool's PostgreSQL driver shared "
"library, load it, and use it to connect to a PostgreSQL server instance. "
"After that, one can pass any PostgreSQL statement to the server instance and"
" receive results."
msgstr ""

msgid ""
"Now, for the PostgreSQL driver shared library, there are two ways to "
"install:"
msgstr ""

msgid ""
"luarocks install pg [POSTGRESQL_LIBDIR = *path*]\n"
"                    [POSTGRESQL_INCDIR = *path*]\n"
"                    [--local]"
msgstr ""

msgid "$ luarocks install pg POSTGRESQL_LIBDIR=/usr/local/postgresql/lib"
msgstr ""

msgid ""
"Go the site `github.com/tarantool/pg`_. Follow the instructions there, "
"saying:"
msgstr ""

msgid ""
"$ git clone https://github.com/tarantool/pg.git\n"
"$ cd pg && cmake . -DCMAKE_BUILD_TYPE=RelWithDebInfo\n"
"$ make\n"
"$ make install"
msgstr ""

msgid ""
"Begin by making a ``require`` request for the pg driver. We will assume that"
" the name is ``pg`` in further examples."
msgstr ""

msgid "pg = require('pg')"
msgstr ""

msgid "*connection_name* = pg.connect(*connection options*)"
msgstr ""

msgid ":samp:`port = {port-number}` - number, default value = 5432"
msgstr ""

msgid ""
":samp:`pass = {password}` or :samp:`password = {password}` - string, default"
" value is blank"
msgstr ""

msgid "The names are similar to the names that PostgreSQL itself uses."
msgstr ""

msgid ""
"conn = pg.connect({\n"
"    host = '127.0.0.1',\n"
"    port = 5432,\n"
"    user = 'p',\n"
"    password = 'p',\n"
"    db = 'test'\n"
"})"
msgstr ""

msgid ""
"tarantool> function pg_connect()\n"
"         >   local p = {}\n"
"         >   p.host = 'widgets.com'\n"
"         >   p.db = 'test'\n"
"         >   p.user = 'postgres'\n"
"         >   p.password = 'postgres'\n"
"         >   local conn = pg.connect(p)\n"
"         >   return conn\n"
"         > end\n"
"---\n"
"...\n"
"tarantool> conn = pg_connect()\n"
"---\n"
"..."
msgstr ""

msgid "For all PostgreSQL statements, the request is:"
msgstr ""

msgid ""
"where ``sql-statement`` is a string, and the optional ``parameters`` are "
"extra values that can be plugged in to replace any placeholders ($1 $2 $3 "
"etc.) in the SQL statement."
msgstr ""

msgid ""
"tarantool> conn:execute('select tablename from pg_tables')\n"
"---\n"
"- - tablename: pg_statistic\n"
"  - tablename: pg_type\n"
"  - tablename: pg_authid\n"
"  <...>\n"
"..."
msgstr ""

msgid "To end a session that began with ``pg.connect``, the request is:"
msgstr ""

msgid ""
"For further information, including examples of rarely-used requests, see the"
" README.md file at `github.com/tarantool/pg`_."
msgstr ""

msgid ""
"The example was run on an Ubuntu 12.04 (\"precise\") machine where tarantool"
" had been installed in a /usr subdirectory, and a copy of PostgreSQL had "
"been installed on /usr. The PostgreSQL server instance is already running on"
" the local host 127.0.0.1."
msgstr ""

msgid ""
"$ # Check that the include subdirectory exists\n"
"$ # by looking for /usr/include/postgresql/libpq-fe-h.\n"
"$ [ -f /usr/include/postgresql/libpq-fe.h ] && echo \"OK\" || echo \"Error\"\n"
"OK\n"
"\n"
"$ # Check that the library subdirectory exists and has the necessary .so file.\n"
"$ [ -f /usr/lib/x86_64-linux-gnu/libpq.so ] && echo \"OK\" || echo \"Error\"\n"
"OK\n"
"\n"
"$ # Check that the psql client can connect using some factory defaults:\n"
"$ # port = 5432, user = 'postgres', user password = 'postgres',\n"
"$ # database = 'postgres'. These can be changed, provided one changes\n"
"$ # them in all places. Insert a row in database postgres, and quit.\n"
"$ psql -h 127.0.0.1 -p 5432 -U postgres -d postgres\n"
"Password for user postgres:\n"
"psql (9.3.10)\n"
"SSL connection (cipher: DHE-RSA-AES256-SHA, bits: 256)\n"
"Type \"help\" for help.\n"
"\n"
"postgres=# CREATE TABLE test (s1 INT, s2 VARCHAR(50));\n"
"CREATE TABLE\n"
"postgres=# INSERT INTO test VALUES (1,'PostgreSQL row');\n"
"INSERT 0 1\n"
"postgres=# \\q\n"
"$\n"
"\n"
"$ # Install luarocks\n"
"$ sudo apt-get -y install luarocks | grep -E \"Setting up|already\"\n"
"Setting up luarocks (2.0.8-2) ...\n"
"\n"
"$ # Set up the Tarantool rock list in ~/.luarocks,\n"
"$ # following instructions at rocks.tarantool.org\n"
"$ mkdir ~/.luarocks\n"
"$ echo \"rocks_servers = {[[http://rocks.tarantool.org/]]}\" >> \\\n"
"        ~/.luarocks/config.lua\n"
"\n"
"$ # Ensure that the next \"install\" will get files from Tarantool master\n"
"$ # repository. The resultant display is normal for Ubuntu 12.04 precise\n"
"$ cat /etc/apt/sources.list.d/tarantool.list\n"
"deb http://tarantool.org/dist/1.7/ubuntu/ precise main\n"
"deb-src http://tarantool.org/dist/1.7/ubuntu/ precise main\n"
"\n"
"$ # Install tarantool-dev. The displayed line should show version = 1.7\n"
"$ sudo apt-get -y install tarantool-dev | grep -E \"Setting up|already\"\n"
"Setting up tarantool-dev (1.7.0.222.g48b98bb~precise-1) ...\n"
"$\n"
"\n"
"$ # Use luarocks to install locally, that is, relative to $HOME\n"
"$ luarocks install pg POSTGRESQL_LIBDIR=/usr/lib/x86_64-linux-gnu --local\n"
"Installing http://rocks.tarantool.org/pg-scm-1.rockspec...\n"
"... (more info about building the Tarantool/PostgreSQL driver appears here)\n"
"pg scm-1 is now built and installed in ~/.luarocks/\n"
"\n"
"$ # Ensure driver.so now has been created in a place\n"
"$ # tarantool will look at\n"
"$ find ~/.luarocks -name \"driver.so\"\n"
"~/.luarocks/lib/lua/5.1/pg/driver.so\n"
"\n"
"$ # Change directory to a directory which can be used for\n"
"$ # temporary tests. For this example we assume that the\n"
"$ # name of this directory is $HOME/tarantool_sandbox.\n"
"$ # (Change \"$HOME\" to whatever is the user's actual\n"
"$ # home directory for the machine that's used for this test.)\n"
"cd $HOME/tarantool_sandbox\n"
"\n"
"$ # Start the Tarantool server instance. Do not use a Lua initialization file.\n"
"\n"
"$ tarantool\n"
"tarantool: version 1.7.0-412-g803b15c\n"
"type 'help' for interactive help\n"
"tarantool>"
msgstr ""

msgid ""
"Configure tarantool and load pg module. Make sure that tarantool doesn't "
"reply \"error\" for the call to \"require()\"."
msgstr ""

msgid ""
"tarantool> box.cfg{}\n"
"...\n"
"tarantool> pg = require('pg')\n"
"---\n"
"..."
msgstr ""

msgid ""
"Create a Lua function that will connect to a PostgreSQL server, (using some "
"factory default values for the port and user and password), retrieve one "
"row, and display the row. For explanations of the statement types used here,"
" read the Lua tutorial earlier in the Tarantool user manual."
msgstr ""

msgid ""
"tarantool> function pg_select ()\n"
"         >   local conn = pg.connect({\n"
"         >     host = '127.0.0.1',\n"
"         >     port = 5432,\n"
"         >     user = 'postgres',\n"
"         >     password = 'postgres',\n"
"         >     db = 'postgres'\n"
"         >   })\n"
"         >   local test = conn:execute('SELECT * FROM test WHERE s1 = 1')\n"
"         >   local row = ''\n"
"         >   for i, card in pairs(test) do\n"
"         >       row = row .. card.s2 .. ' '\n"
"         >       end\n"
"         >   conn:close()\n"
"         >   return row\n"
"         > end\n"
"---\n"
"...\n"
"tarantool> pg_select()\n"
"---\n"
"- 'PostgreSQL row '\n"
"..."
msgstr ""

msgid ""
"Observe the result. It contains \"PostgreSQL row\". So this is the row that "
"was inserted into the PostgreSQL database. And now it's been selected with "
"the Tarantool client."
msgstr ""
