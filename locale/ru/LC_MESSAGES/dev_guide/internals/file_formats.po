
msgid "File formats"
msgstr "Форматы файлов"

msgid "Data persistence and the WAL file format"
msgstr "Персистентность данных и формат WAL-файла"

msgid ""
"To maintain data persistence, Tarantool writes each data change request "
"(insert, update, delete, replace, upsert) into a write-ahead log (WAL) file "
"in the :ref:`wal_dir <cfg_basic-wal_dir>` directory. A new WAL file is "
"created for every :ref:`rows_per_wal <cfg_binary_logging_snapshots-"
"rows_per_wal>` records, or for every :ref:`wal_max_size "
"<cfg_binary_logging_snapshots-wal_max_size>` bytes. Each data change request"
" gets assigned a continuously growing 64-bit log sequence number. The name "
"of the WAL file is based on the log sequence number of the first record in "
"the file, plus an extension ``.xlog``."
msgstr ""
"Чтобы поддерживать персистентность данных, Tarantool записывает каждый "
"запрос изменения данных (insert, update, delete, replace, upsert) в файл "
"журнала упреждающей записи (WAL-файл) в директорию :ref:`wal_dir <cfg_basic-"
"wal_dir>`. Новый WAL-файл создается для количества записей, определенного в "
"параметре :ref:`rows_per_wal <cfg_binary_logging_snapshots-rows_per_wal>`, "
"или для количества байтов, указанного в :ref:`wal_max_size "
"<cfg_binary_logging_snapshots-wal_max_size>` . Каждому запросу на изменение "
"данных присваивается постоянно возрастающее 64-битное число, представляющее "
"собой регистрационный номер в журнале (LSN). Название WAL-файла состоит из "
"LSN первой записи в файле плюс расширение ``.xlog``."

msgid ""
"Apart from a log sequence number and the data change request (formatted as "
"in :ref:`Tarantool's binary protocol <internals-box_protocol>`), each WAL "
"record contains a header, some metadata, and then the data formatted "
"according to `msgpack <https://en.wikipedia.org/wiki/MessagePack>`_ rules. "
"For example, this is what the WAL file looks like after the first INSERT "
"request (\"s:insert({1})\") for the sandbox database created in our "
":ref:`\"Getting started\" exercises <getting_started>`. On the left are the "
"hexadecimal bytes that you would see with:"
msgstr ""
"Помимо номера записи в журнале (LSN) и запроса на изменение данных (в "
"формате :ref:`бинарного протокола Tarantool <internals-box_protocol>`), "
"каждая запись в WAL-файле содержит заголовок, некоторые метаданные, а также "
"данные, форматированные по правилам `msgpack "
"<https://en.wikipedia.org/wiki/MessagePack>`_. Например, так выглядит WAL-"
"файл после первого запроса вставки INSERT (\"s:insert({1})\") для базы "
"данных из песочницы, созданной в упражнениях в :ref:`\"Руководстве для "
"начинающих\" <getting_started>`. Слева представлены шестнадцатеричные байты,"
" которые можно просмотреть с помощью:"

msgid "$ hexdump 00000000000000000000.xlog"
msgstr "$ hexdump 00000000000000000000.xlog"

msgid "and on the right are comments."
msgstr "а справа -- комментарии."

msgid ""
"Hex dump of WAL file       Comment\n"
"--------------------       -------\n"
"58 4c 4f 47 0a             \"XLOG\\n\"\n"
"30 2e 31 33 0a             \"0.13\\n\" = version\n"
"53 65 72 76 65 72 3a 20    \"Server: \"\n"
"38 62 66 32 32 33 65 30 2d [Server UUID]\\n\n"
"36 39 31 34 2d 34 62 35 35\n"
"2d 39 34 64 32 2d 64 32 62\n"
"36 64 30 39 62 30 31 39 36\n"
"0a\n"
"56 43 6c 6f 63 6b 3a 20    \"Vclock: \"\n"
"7b 7d                      \"{}\" = vclock value, initially blank\n"
"...                        (not shown = tuples for system spaces)\n"
"d5 ba 0b ab                Magic row marker always = 0xab0bbad5\n"
"19                         Length, not including length of header, = 25 bytes\n"
"00                           Record header: previous crc32\n"
"ce 8c 3e d6 70               Record header: current crc32\n"
"a7 cc 73 7f 00 00 66 39      Record header: padding\n"
"84                         msgpack code meaning \"Map of 4 elements\" follows\n"
"00 02                         element#1: tag=request type, value=0x02=IPROTO_INSERT\n"
"02 01                         element#2: tag=server id, value=0x01\n"
"03 04                         element#3: tag=lsn, value=0x04\n"
"04 cb 41 d4 e2 2f 62 fd d5 d4 element#4: tag=timestamp, value=an 8-byte \"Float64\"\n"
"82                         msgpack code meaning \"map of 2 elements\" follows\n"
"10 cd 02 00                   element#1: tag=space id, value=512, big byte first\n"
"21 91 01                      element#2: tag=tuple, value=1-element fixed array={1}"
msgstr ""
"Шестнадцатеричный дамп WAL-файла       Комментарий\n"
"--------------------       -------\n"
"58 4c 4f 47 0a             \"XLOG\\n\"\n"
"30 2e 31 33 0a             \"0.13\\n\" = version\n"
"53 65 72 76 65 72 3a 20    \"Server: \"\n"
"38 62 66 32 32 33 65 30 2d [Server UUID]\\n\n"
"36 39 31 34 2d 34 62 35 35\n"
"2d 39 34 64 32 2d 64 32 62\n"
"36 64 30 39 62 30 31 39 36\n"
"0a\n"
"56 43 6c 6f 63 6b 3a 20    \"Vclock: \"\n"
"7b 7d                      \"{}\" = vclock value, initially blank\n"
"...                        (not shown = tuples for system spaces)\n"
"d5 ba 0b ab                Magic row marker always = 0xab0bbad5\n"
"19                         Length, not including length of header, = 25 bytes\n"
"00                           Record header: previous crc32\n"
"ce 8c 3e d6 70               Record header: current crc32\n"
"a7 cc 73 7f 00 00 66 39      Record header: padding\n"
"84                         msgpack code meaning \"Map of 4 elements\" follows\n"
"00 02                         element#1: tag=request type, value=0x02=IPROTO_INSERT\n"
"02 01                         element#2: tag=server id, value=0x01\n"
"03 04                         element#3: tag=lsn, value=0x04\n"
"04 cb 41 d4 e2 2f 62 fd d5 d4 element#4: tag=timestamp, value=an 8-byte \"Float64\"\n"
"82                         msgpack code meaning \"map of 2 elements\" follows\n"
"10 cd 02 00                   element#1: tag=space id, value=512, big byte first\n"
"21 91 01                      element#2: tag=tuple, value=1-element fixed array={1}"

msgid ""
"Tarantool processes requests atomically: a change is either accepted and "
"recorded in the WAL, or discarded completely. Let's clarify how this "
"happens, using the REPLACE request as an example:"
msgstr ""
"Tarantool обрабатывает запросы атомарно: изменение либо принимается и "
"записывается в WAL-файл, или полностью исключается. Проясним, как этом "
"работает, используя в качестве примера REPLACE-запрос:"

msgid ""
"The server instance attempts to locate the original tuple by primary key. If"
" found, a reference to the tuple is retained for later use."
msgstr ""
"Экземпляр сервера пытается найти оригинальный кортеж по первичному ключу. "
"Если кортеж найден, ссылка на него сохраняется для дальнейшего "
"использования."

msgid ""
"The new tuple is validated. If for example it does not contain an indexed "
"field, or it has an indexed field whose type does not match the type "
"according to the index definition, the change is aborted."
msgstr ""
"Происходит проверка нового кортежа. Например, если в нем нет "
"проиндексированного поля, или же тип проиндексированного поля не совпадает с"
" типом в определении индекса, изменение прерывается."

msgid "The new tuple replaces the old tuple in all existing indexes."
msgstr "Новый кортеж заменяет старый кортеж во всех существующих индексах."

msgid ""
"A message is sent to the WAL writer running in a separate thread, requesting"
" that the change be recorded in the WAL. The instance switches to work on "
"the next request until the write is acknowledged."
msgstr ""
"В процесс записи WAL, запущенный в отдельном потоке, отправляется сообщение "
"о необходимости внесения записи в WAL-файл. Экземпляр переключается на "
"работу со следующим запросом, пока запись не будет подтверждена."

msgid ""
"On success, a confirmation is sent to the client. On failure, a rollback "
"procedure is begun. During the rollback procedure, the transaction processor"
" rolls back all changes to the database which occurred after the first "
"failed change, from latest to oldest, up to the first failed change. All "
"rolled back requests are aborted with :errcode:`ER_WAL_IO <ER_WAL_IO>` "
"error. No new change is applied while rollback is in progress. When the "
"rollback procedure is finished, the server restarts the processing pipeline."
msgstr ""
"При успешном выполнении на клиент отправляется подтверждение. В случае "
"ошибки начинается процедура отката. Во время процедуры отката поток "
"обработки транзакций откатывается все изменения в базу данных, которые "
"произошли после первого невыполненного изменения, от последнего с первому, "
"вплоть до первого невыполненного изменения. Все запросы, которые подверглись"
" откату, прерываются с ошибкой :errcode:`ER_WAL_IO <ER_WAL_IO>`. Новые "
"изменения не применяются во время отката. По окончании процедуры отката "
"сервер повторно запускает конвейер обработки операций."

msgid ""
"One advantage of the described algorithm is that complete request pipelining"
" is achieved, even for requests on the same value of the primary key. As a "
"result, database performance doesn't degrade even if all requests refer to "
"the same key in the same space."
msgstr ""
"Одно из преимуществ описанного алгоритма заключается в том, что достигается "
"полная обработка запроса по конвейеру даже для запросов с одинаковым "
"значением первичного ключа. В результате производительность базы данных не "
"падает, даже если все запросы относятся к одному ключу в одном спейсе."

msgid ""
"The transaction processor thread communicates with the WAL writer thread "
"using asynchronous (yet reliable) messaging; the transaction processor "
"thread, not being blocked on WAL tasks, continues to handle requests quickly"
" even at high volumes of disk I/O. A response to a request is sent as soon "
"as it is ready, even if there were earlier incomplete requests on the same "
"connection. In particular, SELECT performance, even for SELECTs running on a"
" connection packed with UPDATEs and DELETEs, remains unaffected by disk "
"load."
msgstr ""
"Поток обработки транзакций взаимодействует с потоком записи в журнал "
"упреждающей записи с помощью асинхронного (однако надежного) обмена "
"сообщениями. Поток обработки транзакций, который не блокируется при задачах "
"записи в журнал, продолжает быстро обрабатывать запрос даже при большом "
"объеме дискового ввода-вывода. Ответ на запрос отправляется по готовности, "
"даже если ранее на том же соединении были незавершенные запросы. В "
"частности, на производительность выборки не влияет загрузка диска, даже если"
" SELECT-запросы передаются вместе с запросами UPDATE и DELETE."

msgid ""
"The WAL writer employs a number of durability modes, as defined in "
"configuration variable :ref:`wal_mode <index-wal_mode>`. It is possible to "
"turn the write-ahead log completely off, by setting :ref:`wal_mode "
"<cfg_binary_logging_snapshots-wal_mode>` to *none*. Even without the write-"
"ahead log it's still possible to take a persistent copy of the entire data "
"set with the :ref:`box.snapshot() <box-snapshot>` request."
msgstr ""
"При записи в WAL можно применять различные режимы долговечности, что "
"определяет конфигурационная переменная :ref:`wal_mode <index-wal_mode>`. "
"Можно полностью отключить журнал упреждающей записи, присвоив :ref:`wal_mode"
" <cfg_binary_logging_snapshots-wal_mode>` значение *none*. Даже без журнала "
"упреждающей записи возможно сделать персистентную копию всего набора данных "
"с помощью запроса :ref:`box.snapshot() <box-snapshot>`."

msgid ""
"An .xlog file always contains changes based on the primary key. Even if the "
"client requested an update or delete using a secondary key, the record in "
"the .xlog file will contain the primary key."
msgstr ""
"Файл в формате .xlog всегда содержит изменения на основании первичного "
"ключа. Даже если клиент запрашивает обновление или удаление по вторичному "
"ключу, запись в файле в формате .xlog будет содержать первичный ключ."

msgid "The snapshot file format"
msgstr "Формат файла снимка"

msgid ""
"The format of a snapshot .snap file is nearly the same as the format of a "
"WAL .xlog file. However, the snapshot header differs: it contains the "
"instance's global unique identifier and the snapshot file's position in "
"history, relative to earlier snapshot files. Also, the content differs: an "
".xlog file may contain records for any data-change requests (inserts, "
"updates, upserts, and deletes), a .snap file may only contain records of "
"inserts to memtx spaces."
msgstr ""
"Формат файла снимка .snap практически такой же, что и формат WAL-файла "
".xlog. Тем не менее, заголовок снимка отличается: он содержит глобально "
"уникальный идентификатор экземпляра и положения файла снимка в истории "
"относительно более ранних файлов снимка. Кроме того, отличается содержание: "
".xlog-файл может содержать записи о любых запросах изменения данных "
"(вставка, обновление, обновление и вставка и удаление), а .snap-файл может "
"содержать лишь записи о вставках в спейсы memtx'а."

msgid ""
"Primarily, the .snap file's records are ordered by space id. Therefore the "
"records of system spaces -- such as ``_schema``, ``_space``, ``_index``, "
"``_func``, ``_priv`` and ``_cluster`` -- will be at the start of the .snap "
"file, before the records of any spaces that were created by users."
msgstr ""
"В первую очередь записи в .snap-файле упорядочены по идентификатору спейса. "
"Таким образом, записи в системные спейсы -- такие как ``_schema``, "
"``_space``, ``_index``, ``_func``, ``_priv`` и ``_cluster`` -- будут "
"находиться в начале .snap-файла до записей в другие спейсы, созданные "
"пользователями."

msgid ""
"Secondarily, the .snap file's records are ordered by primary key within "
"space id."
msgstr ""
"Во вторую очередь записи в .snap-файле упорядочены по первичному ключу."


msgid "XLOG / SNAP"
msgstr "XLOG / SNAP"

msgid ""
"The header of a ``.snap`` or ``.xlog`` file looks like:"
msgstr ""
"Файлы форматов .xlog и .snap выглядят практически одинаково. Заголовок "
"выглядит так:"

msgid ""
"<type>\\n                  SNAP\\n or XLOG\\n\n"
"<version>\\n               currently 0.13\\n\n"
"Server: <server_uuid>\\n   where UUID is a 36-byte string\n"
"VClock: <vclock_map>\\n    e.g. {1: 0}\\n\n"
"\\n"
msgstr ""
"<type>\\n                  SNAP\\n или XLOG\\n\n"
"<version>\\n               в данный момент 0.13\\n\n"
"Server: <server_uuid>\\n   где UUID -- это 36-байтная строка\n"
"VClock: <vclock_map>\\n    например, {1: 0}\\n\n"
"\\n"

msgid ""
"After the file header come the data tuples. Tuples begin with a row marker "
"``0xd5ba0bab`` and the last tuple may be followed by an EOF marker "
"``0xd510aded``. Thus, between the file header and the EOF marker, there may "
"be data tuples that have this form:"
msgstr ""
"После файла заголовка идут кортежи с данными. Кортежи начинаются с маркера "
"строки ``0xd5ba0bab``, а после последнего кортежа может стоять маркер конца "
"файла ``0xd510aded``. Таким образом, между заголовком файла и маркером конца"
" файла могут быть кортежи с данными в следующем виде:"

msgid ""
"0            3 4                                         17\n"
"+-------------+========+============+===========+=========+\n"
"|             |        |            |           |         |\n"
"| 0xd5ba0bab  | LENGTH | CRC32 PREV | CRC32 CUR | PADDING |\n"
"|             |        |            |           |         |\n"
"+-------------+========+============+===========+=========+\n"
"   MP_FIXEXT2    MP_INT     MP_INT       MP_INT      ---\n"
"\n"
"+============+ +===================================+\n"
"|            | |                                   |\n"
"|   HEADER   | |                BODY               |\n"
"|            | |                                   |\n"
"+============+ +===================================+\n"
"     MP_MAP                     MP_MAP"
msgstr ""
"0            3 4                                         17\n"
"+-------------+========+============+===========+=========+\n"
"|             |        |            |           |         |\n"
"| 0xd5ba0bab  | LENGTH | CRC32 PREV | CRC32 CUR | PADDING |\n"
"|             |        |            |           |         |\n"
"+-------------+========+============+===========+=========+\n"
"   MP_FIXEXT2    MP_INT     MP_INT       MP_INT      ---\n"
"\n"
"+============+ +===================================+\n"
"|            | |                                   |\n"
"|   HEADER   | |                BODY               |\n"
"|            | |                                   |\n"
"+============+ +===================================+\n"
"     MP_MAP                     MP_MAP"
